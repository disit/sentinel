<!DOCTYPE html>
{% extends "main.html" %}
{% block title %}SnapSentinel{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}
{% block content %}
<h1>Available Hosts</h1>
<table border="1" cellpadding="5" id="hosts_table">
<thead><tr><th>Host</th><th>User</th><th>Description</th><th>CPU</th><th>MEM</th><th>Delete host</th></tr></thead>
{% for row in hosts %}
<tr>
<td>{{ row['host'] }}</td>
<td>{{ row['user'] }}</td>
<td>{{ row['description'] }}</td>
<td>{{ row['threshold_cpu'] }}</td>
<td>{{ row['threshold_mem'] }}</td>
<td><button class="btn btn-danger" onclick="deleteHost('{{ row['host'] }}')">Delete</button></td>
</tr>
{% endfor %}
</table>
<input type="button" class="btn btn-info" value="Open Top View" onclick="window.open('./get_host_tops')"/>

<h2>Add New Host</h2>
<form id="addForm">
Host: <input id="host" type="text" class="form-control" name="host" required><br>
User: <input id="user" type="text" class="form-control" name="user" required><br>
Description: <input id="description" type="text" class="form-control" name="description" required><br>
CPU: <input id="cpu" type="number" step="0.01" min="0" class="form-control" name="cpu" required><br>
MEM: <input id="mem" type="number" step="0.01" min="0" class="form-control" name="mem" required><br>
Password: <input id="psw" type="password" class="form-control" name="password" required><br>
<button id="button_add" class="form-control" class="btn btn-info">Add Host</button>
</form>


<script>
$('#hosts_table').DataTable();
function deleteHost(host) {
    e.preventDefault();
        try {
            $.ajax({
                url: './delete_saved_host',
                data: {host: host},
                type: 'POST',
                success: function(response) {
                    alert("Host was deleted!");
                    location.reload();
                },
                error: function(error) {
                    alert("Host was not deleted because of: " + error);
                }
            });
        }
        catch (exception_var) {
            console.log(exception_var);
        }
};



$('#button_add').on('click', function(e) {
    e.preventDefault();
    try {
        $.ajax({
            url: './connect_host',
            data: {psw: $('#psw').val(), user: $('#user').val(), description: $('#description').val(), cpu: $('#cpu').val(), mem: $('#mem').val(), host: $('#host').val()},
            type: 'POST',
            success: function(response) {
                alert("Host was added!");
                location.reload();
            },
            error: function(error) {
                alert("Host was not added because of: " + error);
            }
        });
    }
    catch (exception_var) {
        console.log(exception_var);
    }
});
</script>
{% endblock %}